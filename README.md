# Looking for mr Pairs Using Local Peaks 

A high-performance parallel C program for validating the theoretical bounds of unique `mr` values in Collatz sequences using the **local peak ≤ global peak** approach. This tool serves as a **computational verification system** for theoretical predictions in Collatz dynamics.

## Key Innovation: Local vs Global Peak Validation

This program implements a novel validation strategy that verifies a critical theoretical property: the local peak associated with each mr value (derived from its first occurrence) establishes an upper bound that must never be exceeded by the global peak in any sequence containing that mr. This validation demonstrates that the set of 42 mr values is both finite and complete, as increasing n beyond known bounds cannot generate new mr values.

### Core Validation Rule
```
local_peak ≤ global_peak
```

Where:
- **Local Peak**: Maximum known value for each `mr` (from theoretical dictionary)
- **Global Peak**: Maximum `m` value observed in the specific Collatz sequence tuple-based transform
- **Violation**: When `local_peak > global_peak` → **Theoretical impossibility detected!**

## Features

This program analyzes Collatz sequences to find the first repeated value in the transformed sequence of `m` parameters, then validates each discovery against a comprehensive dictionary of known `mr` values and their associated local peaks.

### Core Features
- **Theoretical Validation**: Tests fundamental bounds using local vs global peak comparison
- **Real-time Discovery**: Shows unique `mr` values as they are discovered with classification
- **Violation Detection**: Immediately reports any theoretical impossibilities found
- **New Discovery Detection**: Identifies `mr` values not in the known theoretical dictionary
- **High Performance**: Optimized parallel implementation using OpenMP
- **Adaptive Scheduling**: Automatically chooses optimal work distribution strategy
- **Memory Efficient**: Dynamic memory allocation with intelligent growth
- **Large Scale**: Supports analysis up to 2^64 numbers
- **Thread Safe**: Lock-optimized concurrent access to shared data structures

### Validation Categories
- **VALID**: Known `mr` with `local_peak ≤ global_peak`
- **NEW DISCOVERY**: `mr` not found in theoretical dictionary (theoretically impossible)
- **VIOLATION**: Known `mr` with `local_peak > global_peak` (theoretical contradiction)

## Dependencies

### Ubuntu/Debian
```bash
sudo apt-get install gcc libomp-dev
```

### CentOS/RHEL
```bash
sudo yum install gcc libgomp-devel
```

## Installation

```bash
# Clone the repository
git clone https://github.com/hhvvjj/collatz-looking-for-mr-pairs-using-local-peaks.git
cd collatz-looking-for-mr-pairs-using-local-peaks

# Compile
gcc -fopenmp -O3 -march=native -Wall -Wextra looking_for_mr_pairs_using_local_peaks.c -lgomp -lpthread -o looking_for_mr_pairs_using_local_peaks
```

## Usage

```bash
./looking_for_mr_pairs_using_local_peaks <exponent>
```

### Examples

```bash
# Quick validation test - analyze numbers 1 to 2^20 (1M numbers)
./looking_for_mr_pairs_using_local_peaks 20

# Standard validation - numbers 1 to 2^25 (33M numbers)  
./looking_for_mr_pairs_using_local_peaks 25

# Large scale validation - numbers 1 to 2^30 (1B numbers)
./looking_for_mr_pairs_using_local_peaks 30
```

## Performance Guide

| Exponent | Range | Numbers | Est. Time* | Memory Usage |      Use Cases     |
|----------|-------|---------|------------|--------------|--------------------|
|    15    |  2^15 |   32K   |    < 1 sec |    < 1 MB    | Quick validation   |
|    20    |  2^20 |    1M   |     ~5 sec |    ~10 MB    | Standard testing   |
|    25    |  2^25 |   33M   |   ~2-5 min |    ~50 MB    | Research validation|
|    30    |  2^30 |    1B   | ~1-3 hours |   ~200 MB    | Intensive validation|
|    35    |  2^35 |   34B   |  ~1-2 days |     ~1 GB    | Extreme validation |

*Times are approximate and depend on hardware (8-core CPU assumed)

## Output

### Real-time Validation Progress
```
--------------------------------------------------------------------------------------------------
- Bruteforce Collatz sequences using Tuple-based transform using local and global peaks approach -
--------------------------------------------------------------------------------------------------

Using 8 threads for parallelization
Validating mr values using known dictionary between sequences of n < 2^25...
Range: from 1 to 33554431
Validation rule: local_peak <= global_peak for each mr found

Using scheduling strategy: guided (medium range)

 [*] New unique value of mr = 0 generated by n = 1 (Unique mr found: 1) - [WELL-KNOWN]
 [*] New unique value of mr = 2 generated by n = 3 (Unique mr found: 2) - [WELL-KNOWN]
 [*] New unique value of mr = 6 generated by n = 7 (Unique mr found: 3) - [WELL-KNOWN]
 [!] VIOLATION DETECTED: n = 12345, mr = 25, local_peak = 115 > global_peak = 87
 [*] NEW MR DISCOVERED: mr = 9999 (global_peak = 15000) generated by n = 54321
 ...
Progress: (31.2%) | Processed: 10485760 | Valid mr found: 10485759 | Unique mr found: 42 | New mr found: 0 | Violations: 0 | 2156742.3 nums/sec | ETA: 5.4 min
```

### Validation Results Summary
```
VALIDATION RESULTS:

Known mr values validated (40):

 [*] n = 3, mr = 2, local_peak <= global_peak (4 <= 4) - [VALID]
 [*] n = 11, mr = 3, local_peak <= global_peak (25 <= 25) - [VALID]
 [*] n = 7, mr = 6, local_peak <= global_peak (25 <= 25) - [VALID]
 ...

NEW mr values discovered (0) - THEORETICAL IMPOSSIBILITY:
(No new mr values found - as expected by theory)

VIOLATIONS detected (0): local_peak > global_peak:
(No violations found - theory validated!)

Final Summary:

 [*] Exponent: 13
 [*] Total time: 0.07 seconds
 [*] Speed: 123287.6 numbers/second
 [*] Numbers processed: 2^13 = 8191
 [*] Numbers with mr > 0 found: 5249
 [*] Valid mr validations: 5249
 [*] Unique mr values discovered: 41
 [*] Percentage with mr > 0: 64.08%
 [*] Violations detected: 0

Final list of mr values:
1, 2, 3, 6, 7, 8, 9, 12, 16, 19, 25, 45, 53, 60, 79, 91, 121, 125, 141, 166, 188, 205, 243, 250, 324, 333, 432, 444, 487, 576, 592, 649, 667, 683, 865, 889, 1153, 1214, 1821, 2428, 3643

Results saved to 'looking_for_mr_pairs_using_local_peaks_2_25.txt'
```

### Output Files

The program generates comprehensive CSV files with validation details:

**Format**: `looking_for_mr_pairs_using_local_peaks_2_<exponent>.txt`
```csv
n,mr,type,local_peak,global_peak,status
3,2,known,4,4,valid
11,3,known,25,25,valid
7,6,known,25,25,valid
27,7,known,79,79,valid
...
```

**Column Descriptions**:
- `n`: Starting number that generated the mr
- `mr`: The repeated m value found
- `type`: `known`/`new`/`violation`
- `local_peak`: Theoretical maximum for this mr (from dictionary)
- `global_peak`: Actual maximum observed in the sequence
- `status`: `valid`/`new_discovery`/`violation`

## Research Background

By analyzing the m parameters derived from each step using the tuple-based transform on a Collatz sequence, we can establish theoretical bounds for each unique mr value. The tuple-based transform applies the formula m = (c - p) / 2 where p = 1 for odd values and p = 2 for even values, creating a sequence of m values until the first repetition occurs—this first repeated value becomes the mr for that starting number.

The fundamental hypothesis underlying this validation approach states that for any mr value discovered in a Collatz sequence, the maximum m value observed throughout that entire sequence (global peak) must be at least as large as the theoretical maximum known for that mr across all previously discovered instances (local peak). This relationship emerges from the inherent mathematical structure of Collatz dynamics, where the transformation process creates predictable bounds for each unique mr value.
Theoretical Foundation

The local peak for each mr value is derived from extensive computational analysis of Collatz sequences, representing the highest m value ever observed in any sequence that produces that specific mr. These local peaks establish theoretical upper bounds that should hold universally—if a sequence contains a particular mr, its global peak cannot be smaller than the known local peak for that mr without violating the mathematical consistency of the Collatz conjecture.

This creates a falsifiable test for theoretical predictions:

  - **Validation**: local_peak ≤ global_peak confirms theoretical bounds and mathematical consistency
  - **Violation**: local_peak > global_peak would indicate either a computational error or a fundamental theoretical inconsistency
  - **New Discovery**: Finding an mr not in the dictionary would expand known bounds and require theoretical framework extension

### Scope and Limitations

Note: Value mr = 0 is excluded from validation as it represents special case in the tuple-based transform. Specifically:

    mr = 0: Corresponds to sequences that reach the trivial cycle (4 → 2 → 1) without any intermediate repetitions

This case doesn't exhibit the complex peak behavior that characterizes meaningful Collatz dynamics and therefore fall outside the scope of theoretical bounds analysis.

Implications for Completeness

The validation process serves a dual purpose: it not only confirms the correctness of known bounds but also tests the completeness hypothesis—that the current dictionary of 40 known mr values represents the complete set of all possible mr values. As computational ranges extend to larger values of n, the absence of new mr discoveries provides increasing evidence for the finite nature of the mr value set, supporting theoretical predictions about the bounded complexity of Collatz sequence behavior.

### Known MR Dictionary

The program uses a comprehensive dictionary of 40 known `(mr, local_peak)` pairs:

```c
{1, 7}, {2, 4}, {3, 25}, {6, 25}, {7, 79}, {8, 16}, {9, 43}, {12, 43}, {16, 49}, 
{19, 151}, {25, 115}, {45, 4615}, {53, 106}, {60, 4615}, {79, 4615}, 
{91, 4615}, {121, 4615}, {125, 889}, {141, 889}, {166, 889}, {188, 889}, 
{205, 2347}, {243, 4615}, {250, 889}, {324, 4615}, {333, 10843}, 
{432, 4615}, {444, 10843}, {487, 4939}, {576, 4615}, {592, 10843}, 
{649, 4615}, {667, 10843}, {683, 3643}, {865, 4615}, {889, 10843}, 
{1153, 5191}, {1214, 13849}, {1821, 9223}, {2428, 9223}, {3643, 24595}
```

**Reference:** The complete theoretical framework is detailed in the research paper: https://doi.org/10.5281/zenodo.15546925

## Algorithm Details

### Core Validation Algorithm
1. **Sequence Generation**: Standard 3n+1 Collatz sequence with overflow protection
2. **Transformation**: Apply m = (c-p)/2 for each step where p = c mod 2 if c odd, else 2
3. **Global Peak Tracking**: Monitor maximum m value throughout the sequence
4. **Repetition Detection**: Hash table-optimized tracking until first repetition
5. **Validation**: Compare known local peak with observed global peak
6. **Classification**: Categorize result as valid, violation, or new discovery

### Validation Engine Architecture
- **Discovery Tracker**: Maintains unique mr detection with hash optimization
- **Validation Results**: Categorizes and stores all validation outcomes
- **Progress Tracker**: Real-time monitoring of validation progress
- **Scheduling Config**: Adaptive parallelization strategy selection

### Parallel Strategy
- **Adaptive Scheduling**: 
  - Static scheduling for small ranges (< 1M)
  - Guided scheduling for medium ranges (1M - 100M)
  - Dynamic scheduling with optimal chunking for large ranges (> 100M)
- **Thread Safety**: Fine-grained locking with minimal contention
- **Memory Management**: Dynamic allocation with intelligent capacity growth
- **Validation Tracking**: Real-time violation and discovery reporting

### Performance Optimizations
- **Bit Operations**: Fast modulo and division using bit shifts
- **Hash Tables**: O(1) lookup for both m repetition and mr uniqueness detection
- **Memory Pooling**: Efficient allocation patterns for high-frequency operations
- **Validation Caching**: Optimized dictionary lookup for known mr values

## Contributing

Contributions are welcome! Areas of particular interest:

- **Extended Dictionary**: Adding newly discovered mr values and their peaks
- **Statistical Analysis**: Pattern detection in validation results
- **Extended Validation**: Testing with exponents > 35
- **Theoretical Integration**: Connecting validation results with mathematical proofs

## Academic Citation

For academic use, please cite both the original theoretical work and this implementation.

## License

CC-BY-NC-SA 4.0 License - see LICENSE file for details.

## Contact

For questions about the algorithm implementation or mathematical details drop me an email.